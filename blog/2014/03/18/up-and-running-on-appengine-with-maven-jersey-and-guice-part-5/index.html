<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Up and running on AppEngine with Maven, Jersey and Guice - Part 5 | Development Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is part five of my post on getting a web application up and running on Google AppEngine with Maven, Jersey and Guice.
Part 4 was around getting Jersey set up with JSON and Freemarker. This part w">
<meta property="og:type" content="website">
<meta property="og:title" content="Up and running on AppEngine with Maven, Jersey and Guice - Part 5">
<meta property="og:url" content="http://akshayrangnekar.github.io/blog/2014/03/18/up-and-running-on-appengine-with-maven-jersey-and-guice-part-5/index.html">
<meta property="og:site_name" content="Development Notes">
<meta property="og:description" content="This is part five of my post on getting a web application up and running on Google AppEngine with Maven, Jersey and Guice.
Part 4 was around getting Jersey set up with JSON and Freemarker. This part w">
<meta property="og:image" content="/images/postimages/5/persist.png">
<meta property="og:image" content="/images/postimages/5/retrieveNumber.png">
<meta property="og:image" content="/images/postimages/5/datastoreViewerLocal.png">
<meta property="og:image" content="/images/postimages/5/datastoreViewerAppengine.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Up and running on AppEngine with Maven, Jersey and Guice - Part 5">
<meta name="twitter:description" content="This is part five of my post on getting a web application up and running on Google AppEngine with Maven, Jersey and Guice.
Part 4 was around getting Jersey set up with JSON and Freemarker. This part w">
  
    <link rel="alternative" href="/atom.xml" title="Development Notes" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Development Notes</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Akshay Rangnekar</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://akshayrangnekar.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-up-and-running-on-appengine-with-maven-jersey-and-guice-part-5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/03/18/up-and-running-on-appengine-with-maven-jersey-and-guice-part-5/" class="article-date">
  <time datetime="2014-03-18T18:23:59.000Z" itemprop="datePublished">2014-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Up and running on AppEngine with Maven, Jersey and Guice - Part 5
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is part five of my post on getting a web application up and running on Google AppEngine with Maven, Jersey and Guice.</p>
<p><a href="/blog/2014/03/18/up-and-running-on-appengine-with-maven-jersey-and-guice-part-4/">Part 4</a> was around getting Jersey set up with JSON and Freemarker. This part works through getting Persistence working with JPA.<br><a id="more"></a></p>
<h2 id="Working_with_the_Datastore">Working with the Datastore</h2><p>The final part of this tutorial is getting data saved and retrieved from the AppEngine Datastore. There are a number of options for tools to help you do this including the Java Persistence API (JPA), Java Data Objects (JDO), Objectify or the Datastore’s Low-level API. For reasons of familiarity I’ve chosen to proceed with JPA. There are many discussions out there as to the best option, but the short summary is that it really is dependent on your application and application needs. This was again a fairly complex task to get right, and a big thank you to the author of <a href="http://www.loop81.com/2013/02/gae-google-app-engine-jpa2-maven-and.html" target="_blank" rel="external">this piece</a> which put me in the right direction. </p>
<p>To get started with JPA the first thing we need is a big bunch of dependencies.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.datanucleus<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>datanucleus-api-jpa<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">version</span>&gt;</span>$&#123;datanucleus.jpa.version&#125;<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.datanucleus<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>datanucleus-core<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">version</span>&gt;</span>$&#123;datanucleus.jpa.version&#125;<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>com.google.appengine.orm<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>datanucleus-appengine<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.datanucleus<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>datanucleus-enhancer<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>javax.jdo<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>jdo-api<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.geronimo.specs<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>geronimo-jpa_2.0_spec<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">version</span>&gt;</span>5.1.0.Final<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>The one thing to note is note is that from the AppEngine ORM package, we’re excluding the built-in datanucleus enhancer. This is what takes your <code>@Entity</code> annotated classes and adds to them to make them databaseable. Instead we’re going to use the <code>maven-datanucleus-plugin</code> to do the enhancement.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.datanucleus<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>maven-datanucleus-plugin<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">version</span>&gt;</span>$&#123;datanucleus.jpa.version&#125;<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">api</span>&gt;</span>JPA<span class="tag">&lt;/<span class="title">api</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">mappingIncludes</span>&gt;</span>**/entities/*.class<span class="tag">&lt;/<span class="title">mappingIncludes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="title">verbose</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="title">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.datanucleus<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>datanucleus-core<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">version</span>&gt;</span>$&#123;datanucleus.jpa.version&#125;<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dependencies</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="title">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">execution</span>&gt;</span>   </span><br><span class="line">      <span class="tag">&lt;<span class="title">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="title">phase</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">goal</span>&gt;</span>enhance<span class="tag">&lt;/<span class="title">goal</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">goals</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>If you’re working with Eclipse and the m2eclipse plugin, this will work from the command line, but not eclipse. To proceed in Eclipse, configure the m2e plugin to allow execution of the datanucleus plugin.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">pluginManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.eclipse.m2e<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>lifecycle-mapping<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">lifecycleMappingMetadata</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">pluginExecutions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">pluginExecution</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="title">pluginExecutionFilter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.datanucleus<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>maven-datanucleus-plugin<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">versionRange</span>&gt;</span>$&#123;datanucleus.jpa.version&#125;<span class="tag">&lt;/<span class="title">versionRange</span>&gt;</span></span><br><span class="line">              </span><br><span class="line">                <span class="tag">&lt;<span class="title">goals</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="title">goal</span>&gt;</span>enhance<span class="tag">&lt;/<span class="title">goal</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="title">pluginExecutionFilter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">              <span class="tag">&lt;<span class="title">action</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">execute</span> &gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="title">runOnIncremental</span>&gt;</span>false<span class="tag">&lt;/<span class="title">runOnIncremental</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">execute</span> &gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="title">action</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">pluginExecution</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="title">pluginExecutions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">lifecycleMappingMetadata</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">pluginManagement</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Now if you run the <code>compile</code> goal, you should see log messages indicating that DataNucleus has run. Some of these may appear a little scary, since the logging levels from DataNucleus leave a little to be desired, but look for the message <code>DataNucleus Enhancer completed with success</code> and you should be good.</p>
<p>Now, let’s actually give DataNucleus something to do. Here’s my incredibly simple test entity. </p>
<figure class="highlight java"><figcaption><span>SimpleTestEntity.java</span><a href="/downloads/code/5/SimpleTestEntity.java">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.listerly.entities;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> javax.persistence.GenerationType.IDENTITY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleTestEntity</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Id</span></span><br><span class="line">    <span class="annotation">@GeneratedValue</span>(strategy = IDENTITY)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Date creationDate = <span class="keyword">new</span> Date();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleTestEntity</span><span class="params">()</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>{</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>{</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getCreationDate</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> creationDate;</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Let’s create a new couple of methods in the Resource to exercise this entity - one to create it, and one to retrieve it from the datastore.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@GET</span></span><br><span class="line"><span class="annotation">@Produces</span>(MediaType.TEXT_HTML)</span><br><span class="line"><span class="annotation">@Path</span>(<span class="string">"/persist"</span>)</span><br><span class="line"><span class="annotation">@Template</span>(name=<span class="string">"/foo.ftl"</span>)</span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; persist(<span class="annotation">@QueryParam</span>(<span class="string">"name"</span>) String name, <span class="annotation">@QueryParam</span>(<span class="string">"message"</span>) String message) &#123;</span><br><span class="line">	Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	map.put(<span class="string">"foo"</span>, name);</span><br><span class="line">	map.put(<span class="string">"bar"</span>, message);</span><br><span class="line">	SimpleTestEntity ste = <span class="keyword">new</span> SimpleTestEntity();</span><br><span class="line">	ste.setName(name);</span><br><span class="line">	</span><br><span class="line">    EntityManagerFactory factory = Persistence.createEntityManagerFactory(<span class="string">"transactions-optional"</span>);</span><br><span class="line">    EntityManager entityManager = factory.createEntityManager();</span><br><span class="line">    entityManager.getTransaction().begin();</span><br><span class="line">    entityManager.persist(ste);</span><br><span class="line">    entityManager.getTransaction().commit();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@GET</span></span><br><span class="line"><span class="annotation">@Produces</span>(MediaType.TEXT_HTML)</span><br><span class="line"><span class="annotation">@Path</span>(<span class="string">"/retrieve"</span>)</span><br><span class="line"><span class="annotation">@Template</span>(name=<span class="string">"/foo.ftl"</span>)</span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; retrieve() &#123;</span><br><span class="line">	Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">    EntityManagerFactory factory = Persistence.createEntityManagerFactory(<span class="string">"transactions-optional"</span>);</span><br><span class="line">    EntityManager entityManager = factory.createEntityManager();</span><br><span class="line">    entityManager.getTransaction().begin();</span><br><span class="line">    Query q = entityManager.createQuery(<span class="string">"select t from "</span> + SimpleTestEntity.class.getSimpleName() + <span class="string">" t"</span>);</span><br><span class="line">    List&lt;?&gt; list = q.getResultList();</span><br><span class="line">    map.put(<span class="string">"foo"</span>, <span class="string">"Number of Entries"</span>);</span><br><span class="line">    map.put(<span class="string">"bar"</span>, <span class="string">"The number of database entries is: "</span> + list.size());</span><br><span class="line">    </span><br><span class="line">    entityManager.getTransaction().commit();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Before everything will work nicely, we also need to create a <code>persistence.xml</code> file. This file goes in your <code>src/main/resources</code> directory, in a subdirectory named <code>META-INF</code>.<br><figure class="highlight xml"><figcaption><span>persistence.xml</span><a href="/downloads/code/5/persistence.xml">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">persistence</span> <span class="attribute">xmlns</span>=<span class="value">"http://java.sun.com/xml/ns/persistence"</span></span><br><span class="line">             <span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">             <span class="attribute">xsi:schemaLocation</span>=<span class="value">"http://java.sun.com/xml/ns/persistence</span><br><span class="line">        http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"</span> <span class="attribute">version</span>=<span class="value">"1.0"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">persistence-unit</span> <span class="attribute">name</span>=<span class="value">"transactions-optional"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">provider</span>&gt;</span>org.datanucleus.api.jpa.PersistenceProviderImpl<span class="tag">&lt;/<span class="title">provider</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">class</span>&gt;</span>com.listerly.entities.SimpleTestEntity<span class="tag">&lt;/<span class="title">class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">exclude-unlisted-classes</span>&gt;</span>true<span class="tag">&lt;/<span class="title">exclude-unlisted-classes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"javax.persistence.query.timeout"</span> <span class="attribute">value</span>=<span class="value">"5000"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"datanucleus.appengine.datastoreReadConsistency"</span> <span class="attribute">value</span>=<span class="value">"STRONG"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"datanucleus.appengine.datastoreEnableXGTransactions"</span> <span class="attribute">value</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"datanucleus.datastoreWriteTimeout"</span> <span class="attribute">value</span>=<span class="value">"5000"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"datanucleus.NontransactionalRead"</span> <span class="attribute">value</span>=<span class="value">"false"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"datanucleus.NontransactionalWrite"</span> <span class="attribute">value</span>=<span class="value">"false"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"datanucleus.ConnectionURL"</span> <span class="attribute">value</span>=<span class="value">"appengine"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">persistence-unit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">persistence</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Now if we run the <code>/Hey/persist</code> method a couple of times, we should be adding entities to our datastore:</p>
<img src="/images/postimages/5/persist.png">    
<p>And to be sure, load the <code>/Hey/retrieve</code> URL every few times and make sure you get the expected number:</p>
<img src="/images/postimages/5/retrieveNumber.png">
<p>Deploy to appengine using <code>mvn appengine:update</code> and make sure that everything works the same with the real datastore.</p>
<p>That should all be good. Now lets use the built in datastore viewer to make sure that our objects look right. For the real datastore you can visit <code>appengine.google.com</code> and click “Datastore Viewer” from the left hand navigation bar. For the devserver, you should be able to visit <code>http://localhost:8080/_ah/admin/</code> to do the same thing. Unfortunately, if you try it now you’ll get a 404 when you try to access it. The reason? Jersey thinks it should know how to respond to that URL, and it doesn’t. This is only a problem on the devserver, but it’s something that we should fix anyway. Let’s tell Jersey that it isn’t responsible for URLs that start with <code>/_ah</code>.</p>
<p>First we create our own Filter, that subclasses the Jersey filter (unfortunately named <code>ServletContainer</code> because it can be used in multiple ways):</p>
<figure class="highlight java"><figcaption><span>JerseyFilter.java</span><a href="/downloads/code/5/JerseyFilter.java">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.listerly.config.jersey;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.glassfish.jersey.servlet.ServletContainer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="javadoc">/**</span><br><span class="line"> * Used to filter out GAE reserved URLs</span><br><span class="line"> * See: https://developers.google.com/appengine/docs/java/config/appconfig</span><br><span class="line"> */</span></span><br><span class="line"><span class="annotation">@SuppressWarnings</span>(<span class="string">"serial"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JerseyFilter</span> <span class="keyword">extends</span> <span class="title">ServletContainer</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(HttpServletRequest req, HttpServletResponse res, FilterChain chain)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException </span>{</span><br><span class="line"></span><br><span class="line">        String path = req.getServletPath();</span><br><span class="line">        <span class="keyword">if</span> (path.startsWith(<span class="string">"/_ah/"</span>) || path.equals(<span class="string">"/form"</span>)) {</span><br><span class="line">            chain.doFilter(req, res);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">super</span>.doFilter(req, res, chain);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Then in our <code>web.xml</code> we use our new class as the <code>filter-class</code> instead of <code>ServletContainer</code>.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">filter-class</span>&gt;</span>com.listerly.config.jersey.JerseyFilter<span class="tag">&lt;/<span class="title">filter-class</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Now load up the two datastore viewers and everything should look as you wanted.</p>
<img src="/images/postimages/5/datastoreViewerLocal.png">    
<img src="/images/postimages/5/datastoreViewerAppengine.png">    
<h2 id="Making_JPA_easy">Making  JPA easy</h2><p>Part 5B of this guide was going to be around making JPA easier to use - showing how to create abstract DAOs and concrete implementations for your persistent objects; showing how to make the EntityManager injectable; showing how you could use a filter to start and commit the transaction. However after trying a couple of different approaches out, it became clear that everyone is going to want something slightly different here. That my approach is pretty much guaranteed not to be your approach. So instead, I’ve decided to stop the tutorial here.</p>
<h2 id="Final_words">Final words</h2><p>The final source code for this tutorial is available from github here <a href="https://github.com/akshayrangnekar/gaemavenjerseyguice" target="_blank" rel="external">https://github.com/akshayrangnekar/gaemavenjerseyguice</a> - please drop me a line on twitter (@akshayr) if you run into any problems, or find something that I’ve done wrong. </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://akshayrangnekar.github.io//blog/2014/03/18/up-and-running-on-appengine-with-maven-jersey-and-guice-part-5/" data-id="ci8o7rbcs000ns19yjy0fnqgy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AppEngine/">AppEngine</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JPA/">JPA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2015/04/19/moving-to-hexo/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Moving to Hexo
        
      </div>
    </a>
  
  
    <a href="/blog/2014/03/18/up-and-running-on-appengine-with-maven-jersey-and-guice-part-4/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Up and running on AppEngine with Maven, Jersey and Guice - Part 4</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/AppEngine/">AppEngine</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/Server/">Server</a><span class="category-list-count">1</span></li></ul></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AppEngine/">AppEngine</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Freemarker/">Freemarker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Guice/">Guice</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JPA/">JPA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jersey/">Jersey</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maven/">Maven</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AppEngine/" style="font-size: 20px;">AppEngine</a><a href="/tags/Freemarker/" style="font-size: 10px;">Freemarker</a><a href="/tags/Guice/" style="font-size: 12.5px;">Guice</a><a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a><a href="/tags/JPA/" style="font-size: 10px;">JPA</a><a href="/tags/Java/" style="font-size: 20px;">Java</a><a href="/tags/Jersey/" style="font-size: 15px;">Jersey</a><a href="/tags/Maven/" style="font-size: 17.5px;">Maven</a><a href="/tags/git/" style="font-size: 12.5px;">git</a><a href="/tags/github/" style="font-size: 10px;">github</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2015/04/19/moving-to-hexo/">Moving to Hexo</a>
          </li>
        
          <li>
            <a href="/blog/2014/03/18/up-and-running-on-appengine-with-maven-jersey-and-guice-part-5/">Up and running on AppEngine with Maven, Jersey and Guice - Part 5</a>
          </li>
        
          <li>
            <a href="/blog/2014/03/18/up-and-running-on-appengine-with-maven-jersey-and-guice-part-4/">Up and running on AppEngine with Maven, Jersey and Guice - Part 4</a>
          </li>
        
          <li>
            <a href="/blog/2014/03/18/up-and-running-on-appengine-with-maven-jersey-and-guice-part-3/">Up and running on AppEngine with Maven, Jersey and Guice - Part 3</a>
          </li>
        
          <li>
            <a href="/blog/2014/03/14/up-and-running-on-appengine-with-maven-jersey-and-guice-part-2/">Up and running on AppEngine with Maven, Jersey and Guice - Part 2</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Akshay Rangnekar<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>